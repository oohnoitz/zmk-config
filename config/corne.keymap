/*
 * Copyright (c) 2020 The ZMK Contributors
 *
 * SPDX-License-Identifier: MIT
 */

#define ZMK_MOUSE_DEFAULT_MOVE_VAL 1500
#define ZMK_MOUSE_DEFAULT_SCRL_VAL 20

#include "keypos_def/keypos_42keys.h"
#include <behaviors.dtsi>
#include <behaviors/mouse_keys.dtsi>
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/bt.h>
#include <dt-bindings/zmk/mouse.h>

#define XXX &none
#define ___ &trans

#define NAV_UP    &mt LC(HOME) UP      // tap: up    | long-tap: beginning of document
#define NAV_DOWN  &mt LC(END)  DOWN    // tap: down  | long-tap: end       of document

&mt {
  tapping-term-ms = <200>;
  flavor = "tap-preferred";
  quick-tap-ms = <200>;
};

&mmv {
  acceleration-exponent = <1>;
  time-to-max-speed-ms = <500>;
  delay-ms = <0>;
};

&msc {
  acceleration-exponent = <1>;
  time-to-max-speed-ms = <40>;
  delay-ms = <0>;
};

&sk {
  quick-release;
};

/ {
  behaviors {
    hml: hml {
      compatible = "zmk,behavior-hold-tap";
      #binding-cells = <2>;
      tapping-term-ms = <275>;
      quick-tap-ms = <175>;
      flavor = "balanced";
      bindings = <&kp>, <&kp>;
      hold-trigger-key-positions = <KEYS_R THUMBS>;
      hold-trigger-on-release;
      require-prior-idle-ms = <150>;
    };
    hmr: hmr {
      compatible = "zmk,behavior-hold-tap";
      #binding-cells = <2>;
      tapping-term-ms = <275>;
      quick-tap-ms = <175>;
      flavor = "balanced";
      bindings = <&kp>, <&kp>;
      hold-trigger-key-positions = <KEYS_L THUMBS>;
      hold-trigger-on-release;
      require-prior-idle-ms = <150>;
    };
  };

  keymap {
    compatible = "zmk,keymap";

    default_layer {
      display-name = "QWE";
      bindings = <
      //+----------------+----------------+----------------+----------------+----------------+----------------+ +----------------+----------------+----------------+----------------+----------------+----------------+
          &kp TAB          &kp Q            &kp W            &kp E            &kp R            &kp T              &kp Y            &kp U            &kp I            &kp O            &kp P            &kp DEL
      //+----------------+----------------+----------------+----------------+----------------+----------------+ +----------------+----------------+----------------+----------------+----------------+----------------+
          &mt LCTRL ESC    &hml LGUI A      &hml LALT S      &hml LSHFT D     &hml LCTRL F     &lt 5 G            &kp H            &hmr LCTRL J     &hmr LSHFT K     &hmr LALT L      &hmr LGUI SQT    &sk LALT
      //+----------------+----------------+----------------+----------------+----------------+----------------+ +----------------+----------------+----------------+----------------+----------------+----------------+
          &sk LSHFT        &kp Z            &kp X            &kp C            &kp V            &kp B              &kp N            &kp M            &kp COMMA        &kp DOT          &kp SEMI         &mo 6
      //+----------------+----------------+----------------+----------------+----------------+----------------+ +----------------+----------------+----------------+----------------+----------------+----------------+
                                                             &mt LGUI TAB     &lt 2 ESC        &lt 4 SPACE        &mt LSHFT RET    &lt 3 BSPC       &sk LALT
      //                                                   +----------------+----------------+----------------+ +----------------+----------------+----------------+
      >;
    };

    colemak_layer {
      display-name = "COL";
      bindings = <
      //+----------------+----------------+----------------+----------------+----------------+----------------+ +----------------+----------------+----------------+----------------+----------------+----------------+
          &kp TAB          &kp Q            &kp W            &kp F            &kp P            &kp B              &kp J            &kp L            &kp U            &kp Y            &kp SQT          &kp DEL
      //+----------------+----------------+----------------+----------------+----------------+----------------+ +----------------+----------------+----------------+----------------+----------------+----------------+
          &mt LCTRL ESC    &hml LGUI A      &hml LALT R      &hml LSHFT S     &hml LCTRL T     &lt 5 G            &kp M            &hmr LCTRL N     &hmr LSHFT E     &hmr LALT I      &hmr LGUI O      &sk LALT
      //+----------------+----------------+----------------+----------------+----------------+----------------+ +----------------+----------------+----------------+----------------+----------------+----------------+
          &sk LSHFT        &kp Z            &kp X            &kp C            &kp D            &kp V              &kp K            &kp H            &kp COMMA        &kp DOT          &kp SEMI         &mo 6
      //+----------------+----------------+----------------+----------------+----------------+----------------+ +----------------+----------------+----------------+----------------+----------------+----------------+
                                                             &mt LGUI TAB     &lt 2 ESC        &lt 4 SPACE        &mt LSHFT RET    &lt 3 BSPC       &sk LALT
      //                                                   +----------------+----------------+----------------+ +----------------+----------------+----------------+
      >;
    };

    num_layer {
      display-name = "NUM";
      bindings = <
      //+----------------+----------------+----------------+----------------+----------------+----------------+ +----------------+----------------+----------------+----------------+----------------+----------------+
          ___              XXX              XXX              XXX              XXX              XXX                XXX              &kp N7           &kp N8           &kp N9           &kp COMMA        ___
      //+----------------+----------------+----------------+----------------+----------------+----------------+ +----------------+----------------+----------------+----------------+----------------+----------------+
          ___              &kp LGUI         &kp LALT         &kp LSHFT        &kp LCTRL        XXX                &kp N0           &kp N4           &kp N5           &kp N6           &kp DOT          ___
      //+----------------+----------------+----------------+----------------+----------------+----------------+ +----------------+----------------+----------------+----------------+----------------+----------------+
          ___              XXX              XXX              XXX              XXX              XXX                XXX              &kp N1           &kp N2           &kp N3           XXX              ___
      //+----------------+----------------+----------------+----------------+----------------+----------------+ +----------------+----------------+----------------+----------------+----------------+----------------+
                                                             ___              ___              ___                ___              ___              ___
      //                                                   +----------------+----------------+----------------+ +----------------+----------------+----------------+
      >;
    };

    sym_layer {
      display-name = "SYM";
      bindings = <
      //+----------------+----------------+----------------+----------------+----------------+----------------+ +----------------+----------------+----------------+----------------+----------------+----------------+
          ___              &kp EXCL         &kp AT           &kp HASH         &kp DLLR         &kp PRCNT          &kp CARET        &kp AMPS         &kp ASTRK        &kp QMARK        &kp SQT          ___
      //+----------------+----------------+----------------+----------------+----------------+----------------+ +----------------+----------------+----------------+----------------+----------------+----------------+
          ___              &kp PLUS         &kp EQUAL        &kp LPAR         &kp RPAR         &kp DQT            &kp COLON        &kp RBKT         &kp LBKT         &kp RBRC         &kp LBRC         ___
      //+----------------+----------------+----------------+----------------+----------------+----------------+ +----------------+----------------+----------------+----------------+----------------+----------------+
          ___              &kp LT           &kp PIPE         &kp MINUS        &kp GT           &kp BSLH           &kp GRAVE        &kp UNDER        &kp FSLH         &kp TILDE        &kp SEMI         ___
      //+----------------+----------------+----------------+----------------+----------------+----------------+ +----------------+----------------+----------------+----------------+----------------+----------------+
                                                             ___              ___              ___                ___              ___              ___
      //                                                   +----------------+----------------+----------------+ +----------------+----------------+----------------+
      >;
    };

    nav_layer {
      display-name = "NAV";
      bindings = <
      //+----------------+----------------+----------------+----------------+----------------+----------------+ +----------------+----------------+----------------+----------------+----------------+----------------+
          ___              &kp C_MUTE       XXX              XXX              XXX              XXX                &kp PG_UP        &kp HOME         NAV_UP           &kp END          &kp PSCRN        ___
      //+----------------+----------------+----------------+----------------+----------------+----------------+ +----------------+----------------+----------------+----------------+----------------+----------------+
          ___              &kp LGUI         &kp LALT         &kp LSHFT        &kp LCTRL        XXX                &kp PG_DN        &kp LEFT         NAV_DOWN         &kp RIGHT        &kp K_APP        ___
      //+----------------+----------------+----------------+----------------+----------------+----------------+ +----------------+----------------+----------------+----------------+----------------+----------------+
          ___              XXX              XXX              XXX              XXX              XXX                &kp C_PP         &kp C_PREV       &kp C_NEXT       &kp C_VOL_DN     &kp C_VOL_UP     ___
      //+----------------+----------------+----------------+----------------+----------------+----------------+ +----------------+----------------+----------------+----------------+----------------+----------------+
                                                             ___              ___              ___                ___              ___              ___
      //                                                   +----------------+----------------+----------------+ +----------------+----------------+----------------+
      >;
    };

    mse_layer {
      display-name = "MSE";
      bindings = <
      //+----------------+----------------+----------------+----------------+----------------+----------------+ +----------------+----------------+----------------+----------------+----------------+----------------+
          ___              XXX              XXX              XXX              XXX              XXX                &msc SCRL_LEFT   &msc SCRL_DOWN   &mmv MOVE_UP     &msc SCRL_UP     &msc SCRL_RIGHT  ___
      //+----------------+----------------+----------------+----------------+----------------+----------------+ +----------------+----------------+----------------+----------------+----------------+----------------+
          ___              &kp LGUI         &kp LALT         &kp LSHFT        &kp LCTRL        XXX                &mkp MB5         &mmv MOVE_LEFT   &mmv MOVE_DOWN   &mmv MOVE_RIGHT  XXX              ___
      //+----------------+----------------+----------------+----------------+----------------+----------------+ +----------------+----------------+----------------+----------------+----------------+----------------+
          ___              XXX              XXX              XXX              ___              XXX                &mkp MB4         XXX              XXX              XXX              XXX              ___
      //+----------------+----------------+----------------+----------------+----------------+----------------+ +----------------+----------------+----------------+----------------+----------------+----------------+
                                                             ___              ___              ___                &mkp LCLK        &mkp RCLK        &mkp MCLK
      //                                                   +----------------+----------------+----------------+ +----------------+----------------+----------------+
      >;
    };

    fun_layer {
      display-name = "FUN";
      bindings = <
      //+----------------+----------------+----------------+----------------+----------------+----------------+ +----------------+----------------+----------------+----------------+----------------+----------------+
          ___              &kp F1           &kp F2           &kp F3           &kp F4           XXX                &to 0            &to 1            XXX              XXX              &bt BT_CLR       ___
      //+----------------+----------------+----------------+----------------+----------------+----------------+ +----------------+----------------+----------------+----------------+----------------+----------------+
          ___              &kp F5           &kp F6           &kp F7           &kp F8           XXX                &bt BT_SEL 0     &bt BT_SEL 1     &bt BT_SEL 2     &bt BT_SEL 3     &bt BT_SEL 4     ___
      //+----------------+----------------+----------------+----------------+----------------+----------------+ +----------------+----------------+----------------+----------------+----------------+----------------+
          ___              &kp F9           &kp F10          &kp F11          &kp F12          XXX                XXX              XXX              XXX              XXX              XXX              ___
      //+----------------+----------------+----------------+----------------+----------------+----------------+ +----------------+----------------+----------------+----------------+----------------+----------------+
                                                             ___              ___              ___                ___              ___              ___
      //                                                   +----------------+----------------+----------------+ +----------------+----------------+----------------+
      >;
    };
  };
};
